<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planning M√©nage - Grey Corner Cafe</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            -webkit-print-color-adjust: exact;
        }
        @media print {
            .no-print { display: none !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef } = React;

        const PLANNING_DATA = {
            S1: {
                id: 'S1',
                title: 'Planning m√©nage S1',
                schedules: [
                    { day: 'lundi', matin: { staff: 'SOUAD G' }, soir: { staff: 'SOUAD M / HAKIMA' } },
                    { day: 'mardi', matin: { staff: 'SAOUAD M' }, soir: { staff: 'SOUAD G / ANISSA' } },
                    { day: 'mercredi', matin: { staff: 'ANISSA' }, soir: { staff: 'SOUAD M / HAKIMA' } },
                    { day: 'jeudi', matin: { staff: 'HAKIMA' }, soir: { staff: 'SOUAD G / ANISSA' } },
                    { day: 'vendredi', matin: { staff: 'SOUAD G / ANISSA' }, soir: { staff: 'SOUAD M / HAKIMA' } },
                    { day: 'samedi', matin: { staff: 'SOUAD M / HAKIMA' }, soir: { staff: 'SOUAD G / ANISSA' } },
                    { day: 'dimanche', matin: { staff: 'SOUAD G / ANISSA' }, soir: { staff: 'SOUAD M / HAKIMA' } },
                ]
            },
            S2: {
                id: 'S2',
                title: 'Planning m√©nage S2',
                schedules: [
                    { day: 'lundi', matin: { staff: 'SOUAD M' }, soir: { staff: 'SOUAD G / ANISSA' } },
                    { day: 'mardi', matin: { staff: 'SAOUAD G' }, soir: { staff: 'SOUAD M / HAKIMA' } },
                    { day: 'mercredi', matin: { staff: 'HAKIMA' }, soir: { staff: 'SOUAD G / ANISSA' } },
                    { day: 'jeudi', matin: { staff: 'ANISSA' }, soir: { staff: 'SOUAD M / HAKIMA' } },
                    { day: 'vendredi', matin: { staff: 'SOUAD M / HAKIMA' }, soir: { staff: 'SOUAD G / ANISSA' } },
                    { day: 'samedi', matin: { staff: 'SOUAD G / ANISSA' }, soir: { staff: 'SOUAD M / HAKIMA' } },
                    { day: 'dimanche', matin: { staff: 'SOUAD M / HAKIMA' }, soir: { staff: 'SOUAD G / ANISSA' } },
                ]
            }
        };

        const SunIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364-6.364l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707M6.343 6.343l-.707-.707M12 8a4 4 0 100 8 4 4 0 000-8z" /></svg>);
        const MoonIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>);

        // Composant de la table pour r√©utilisation dans le PDF
        const PlanningTable = ({ planning, today }) => (
            <div className="bg-white shadow-2xl rounded-[2.5rem] overflow-hidden border border-slate-200 w-full mb-10">
                <table className="w-full text-left border-collapse">
                    <thead>
                        <tr className="bg-[#96d35f] text-slate-900 uppercase text-xs font-black tracking-widest">
                            <th className="px-10 py-6 border-r border-black/5">Jour</th>
                            <th className="px-10 py-6 border-r border-black/5 flex items-center gap-2"><SunIcon /> Matin</th>
                            <th className="px-10 py-6 flex items-center gap-2"><MoonIcon /> Soir</th>
                        </tr>
                    </thead>
                    <tbody>
                        {planning.schedules.map((row) => {
                            const isToday = row.day === today;
                            const isWE = ['vendredi', 'samedi', 'dimanche'].includes(row.day);
                            return (
                                <tr key={row.day} className={isToday ? 'bg-indigo-50/50' : ''}>
                                    <td className="px-10 py-8 border-b border-slate-100 border-r bg-[#96d35f]/5 font-black uppercase text-slate-800 text-sm">
                                        {row.day} {isToday && <span className="ml-2 text-[9px] bg-indigo-600 text-white px-2 py-1 rounded-md">Auj.</span>}
                                    </td>
                                    <td className="px-10 py-8 border-b border-slate-100 border-r bg-[#f48a3c]/5">
                                        <span className="text-xs text-[#f48a3c] font-black block mb-1 uppercase tracking-tighter">{isWE ? '06:30 - 14:00' : '06:30 - 12:00'}</span>
                                        <span className="text-xl font-bold text-slate-900">{row.matin.staff}</span>
                                    </td>
                                    <td className="px-10 py-8 border-b border-slate-100 bg-[#ffb600]/5">
                                        <span className="text-xs text-[#d97706] font-black block mb-1 uppercase tracking-tighter">{isWE ? '14:00 - Fin' : '12:00 - Fin'}</span>
                                        <span className="text-xl font-bold text-slate-900">{row.soir.staff}</span>
                                    </td>
                                </tr>
                            );
                        })}
                    </tbody>
                </table>
            </div>
        );

        const App = () => {
            const [activeWeek, setActiveWeek] = useState('S1');
            const [isGenerating, setIsGenerating] = useState(false);
            const contentRef = useRef(null);
            
            const today = new Intl.DateTimeFormat('fr-FR', { weekday: 'long' }).format(new Date()).toLowerCase();

            const generatePDF = async (targetElement, filename) => {
                const canvas = await html2canvas(targetElement, { scale: 2, useCORS: true, backgroundColor: '#f8fafc' });
                const imgData = canvas.toDataURL('image/png');
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({ orientation: 'landscape', unit: 'px', format: 'a4' });
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
                pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                pdf.save(filename);
            };

            const handleDownloadFullExport = async () => {
                setIsGenerating(true);
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({ orientation: 'landscape', unit: 'px', format: 'a4' });
                
                // On boucle sur S1 et S2 pour cr√©er les pages
                const weeks = ['S1', 'S2'];
                for (let i = 0; i < weeks.length; i++) {
                    setActiveWeek(weeks[i]);
                    // Petit d√©lai pour laisser React faire le rendu de la nouvelle semaine
                    await new Promise(r => setTimeout(r, 300));
                    
                    const canvas = await html2canvas(contentRef.current, { scale: 2, useCORS: true, backgroundColor: '#f8fafc' });
                    const imgData = canvas.toDataURL('image/png');
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
                    
                    if (i > 0) pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                }
                
                pdf.save(`Planning-Complet-GreyCorner.pdf`);
                setIsGenerating(false);
            };

            return (
                <div className="min-h-screen bg-slate-50 flex flex-col items-center py-8 px-4">
                    <header className="w-full max-w-4xl flex flex-col items-center mb-8 no-print">
                        <div className="bg-white p-5 shadow-xl rounded-3xl border border-slate-200 flex items-center gap-5 mb-8">
                            <div className="text-center border-2 border-slate-900 p-2">
                                <div className="font-black text-lg uppercase tracking-widest text-slate-900">Corner</div>
                            </div>
                            <div>
                                <h1 className="text-2xl font-black text-slate-900">Planning M√©nage</h1>
                                <p className="text-slate-400 text-[10px] font-bold uppercase tracking-widest">Interface Export PDF</p>
                            </div>
                        </div>

                        <div className="flex flex-wrap justify-center gap-4">
                            <div className="inline-flex rounded-2xl shadow-lg bg-white p-1.5 border border-slate-200">
                                {['S1', 'S2'].map((w) => (
                                    <button key={w} onClick={() => setActiveWeek(w)} className={`px-8 py-3 text-sm font-black rounded-xl transition-all ${activeWeek === w ? 'bg-slate-900 text-white shadow-md' : 'text-slate-500 hover:bg-slate-50'}`}>
                                        Semaine {w}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </header>

                    <main ref={contentRef} className="w-full max-w-5xl flex flex-col gap-8 p-10 bg-slate-50">
                        <div className="text-center">
                            <h2 className="text-4xl font-black text-slate-900 uppercase italic">{PLANNING_DATA[activeWeek].title}</h2>
                            <div className="h-2 w-24 bg-[#96d35f] mx-auto mt-4 rounded-full"></div>
                        </div>
                        <PlanningTable planning={PLANNING_DATA[activeWeek]} today={today} />
                    </main>

                    <div className="w-full max-w-4xl mt-10 flex flex-col sm:flex-row gap-4 no-print">
                        <button 
                            onClick={() => generatePDF(contentRef.current, `Planning-${activeWeek}.pdf`)}
                            disabled={isGenerating}
                            className="flex-1 px-6 py-4 bg-white border-2 border-slate-200 text-slate-900 rounded-2xl font-black text-xs uppercase tracking-widest hover:border-slate-900 transition-all flex items-center justify-center gap-2"
                        >
                            ‚¨áÔ∏è T√©l√©charger Semaine {activeWeek}
                        </button>
                        
                        <button 
                            onClick={handleDownloadFullExport}
                            disabled={isGenerating}
                            className="flex-1 px-6 py-4 bg-slate-900 text-white rounded-2xl font-black text-xs uppercase tracking-[0.2em] shadow-xl hover:bg-slate-800 transition-all flex items-center justify-center gap-3"
                        >
                            {isGenerating ? "G√©n√©ration..." : "üìÑ T√©l√©charger TOUTE LA SEMAINE (S1 + S2)"}
                        </button>
                    </div>

                    <footer className="mt-16 text-[10px] font-black text-slate-300 uppercase tracking-widest no-print">
                        ¬© {new Date().getFullYear()} Grey Corner Cafe
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
</body>
</html>
